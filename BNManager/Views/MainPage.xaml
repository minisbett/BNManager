<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="BNManager.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:m="using:BNManager.Models"
    xmlns:vm="using:BNManager.ViewModels"
    x:Name="Page"
    mc:Ignorable="d">

  <Page.DataContext>
    <vm:MainViewModel x:Name="ViewModel" />
  </Page.DataContext>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    <Grid x:Name="TitleBar" Grid.Column="1" ColumnSpacing="8" Margin="16,8,8,8">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="auto" />
        <ColumnDefinition Width="auto" />
      </Grid.ColumnDefinitions>
      <Border CornerRadius="6" Width="32" Height="32">
        <Border.Background>
          <ImageBrush  ImageSource="{StaticResource LogoCompact}" />
        </Border.Background>
      </Border>
      <TextBlock Grid.Column="1" Text="BN Manager" VerticalAlignment="Center" />
    </Grid>
    <NavigationView Grid.Row="1" CompactPaneLength="66" OpenPaneLength="256" MenuItemsSource="{x:Bind ViewModel.FilteredProjects,Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedProject,Mode=TwoWay}" IsBackButtonVisible="Collapsed" IsPaneOpen="False">
      <NavigationView.AutoSuggestBox>
        <AutoSuggestBox PlaceholderText="Search for projects..." QueryIcon="Find" Text="{x:Bind ViewModel.SearchQuery,Mode=TwoWay}" />
      </NavigationView.AutoSuggestBox>
      <NavigationView.MenuItemTemplate>
        <DataTemplate x:DataType="vm:ProjectViewModel">
          <NavigationViewItem>
            <Grid ColumnSpacing="8">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
              </Grid.ColumnDefinitions>
              <Border Width="42" Height="42" CornerRadius="12">
                <Border.Background>
                  <ImageBrush Stretch="UniformToFill" ImageSource="{x:Bind Cover}" />
                </Border.Background>
              </Border>
              <TextBlock Grid.Column="1" Text="{x:Bind Name,Mode=OneWay}" VerticalAlignment="Center" TextWrapping="Wrap" MaxWidth="166" />
            </Grid>
            <NavigationViewItem.ContextFlyout>
              <MenuFlyout>
                <MenuFlyoutItem Text="Edit" Icon="Edit" Command="{x:Bind EditProjectCommand}" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Remove" Icon="Delete" Command="{x:Bind DeleteProjectCommand}" />
              </MenuFlyout>
            </NavigationViewItem.ContextFlyout>
          </NavigationViewItem>
        </DataTemplate>
      </NavigationView.MenuItemTemplate>
      <Frame>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <Grid RowSpacing="8" Visibility="{x:Bind ViewModel.IsProjectSelected,Mode=OneWay,Converter={StaticResource BoolToVisibility}}">
            <Grid.RowDefinitions>
              <RowDefinition Height="auto" />
              <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid MaxHeight="100" Margin="16,8,16,0" ColumnSpacing="16">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
              </Grid.ColumnDefinitions>
              <AutoSuggestBox Text="{x:Bind ViewModel.SelectedProject.SearchQuery,Mode=TwoWay}" QueryIcon="Find" PlaceholderText="Search..." Width="240" />
              <ComboBox Grid.Column="1" Width="115" ItemsSource="{x:Bind m:DisplayableStateFilterOption.Options}" SelectedValue="{x:Bind ViewModel.SelectedProject.StateFilter,Mode=TwoWay}" />
              <CheckBox Grid.Column="2" MinWidth="120" Content="Ignore Modes" IsChecked="{x:Bind ViewModel.SelectedProject.IgnoreModes,Mode=TwoWay}" ToolTipService.ToolTip="Ignores the game modes targetted in the Project settings." />
              <ComboBox Grid.Column="4" Width="165" ItemsSource="{x:Bind m:DisplayableSortOption.Options}" SelectedValue="{x:Bind ViewModel.SelectedProject.Sort,Mode=TwoWay}" />
            </Grid>
            <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.SelectedProject.FilteredNominatorStates,Mode=OneWay}" SelectionMode="None" IsItemClickEnabled="True">
              <ListView.ItemTemplate>
                <DataTemplate x:DataType="vm:NominatorStateViewModel">
                  <Grid VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="auto" />
                      <ColumnDefinition Width="auto" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="auto" />
                    </Grid.ColumnDefinitions>
                    <Border CornerRadius="16" Width="84" Height="84" Margin="0,12,12,12">
                      <Border.Background>
                        <ImageBrush Stretch="Fill" ImageSource="{x:Bind AvatarUrl}" />
                      </Border.Background>
                    </Border>
                    <FontIcon Glyph="&#xF136;" Margin="0,0,4,4" Foreground="LightGreen" FontSize="18" VerticalAlignment="Bottom" HorizontalAlignment="Right" ToolTipService.ToolTip="The queue is currently opened." Visibility="{x:Bind IsOpened,Converter={StaticResource BoolToVisibility}}" />
                    <FontIcon Glyph="&#xEB90;" Margin="0,0,4,4" Foreground="IndianRed" FontSize="18" VerticalAlignment="Bottom" HorizontalAlignment="Right" ToolTipService.ToolTip="The queue is currently closed." Visibility="{x:Bind IsOpened,Converter={StaticResource InvBoolToVisibility}}" />
                    <Grid Grid.Column="1" Margin="0,16,0,0" RowSpacing="4">
                      <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                      </Grid.RowDefinitions>
                      <Grid ColumnSpacing="6">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="auto" />
                          <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="{x:Bind Nominator.Name}" FontSize="24" FontWeight="SemiBold" />
                      </Grid>
                      <StackPanel Grid.Row="1" Orientation="Horizontal">
                        <ItemsControl ItemsSource="{x:Bind GroupBadges}">
                          <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                              <StackPanel Orientation="Horizontal" Spacing="8" />
                            </ItemsPanelTemplate>
                          </ItemsControl.ItemsPanel>
                          <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="m:GroupBadge">
                              <Border CornerRadius="8" Width="auto">
                                <Border.Background>
                                  <SolidColorBrush Color="{StaticResource BadgeBackground}" />
                                </Border.Background>
                                <StackPanel Orientation="Horizontal" Margin="6" VerticalAlignment="Center">
                                  <TextBlock Text="{x:Bind ModeIcons}" Margin="0,0,4,0" FontFamily="{StaticResource OsuFont}" FontSize="14" VerticalAlignment="Center" />
                                  <TextBlock Text="{x:Bind DisplayName}" Foreground="{x:Bind Brush}" FontSize="14" VerticalAlignment="Center" />
                                </StackPanel>
                              </Border>
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                      </StackPanel>
                    </Grid>
                    <ComboBox ItemsSource="{x:Bind m:DisplayableAskState.Options}" SelectedItem="{x:Bind State,Mode=TwoWay}" Grid.Column="3" MinWidth="115" VerticalAlignment="Center" Margin="0,0,4,0">
                      <ComboBox.ItemTemplate>
                        <DataTemplate x:DataType="m:DisplayableAskState">
                          <TextBlock Text="{x:Bind ToString()}" Foreground="{x:Bind Brush}" TextAlignment="Center" />
                        </DataTemplate>
                      </ComboBox.ItemTemplate>
                    </ComboBox>
                  </Grid>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>
          </Grid>
          <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,0,50" Visibility="{x:Bind ViewModel.IsProjectSelected,Mode=OneWay,Converter={StaticResource InvBoolToVisibility}}">
            <Grid.RowDefinitions>
              <RowDefinition Height="auto" />
              <RowDefinition Height="auto" />
              <RowDefinition Height="auto" />
              <RowDefinition Height="auto" />
            </Grid.RowDefinitions>
            <Image Source="{StaticResource Logo}" Width="256" Height="256" HorizontalAlignment="Center" />
            <TextBlock Grid.Row="1" Text="BN Manager" FontSize="48" />
            <TextBlock Grid.Row="2" Text="by minisbett" FontSize="18" HorizontalAlignment="Center" />
            <Grid Grid.Row="3" ColumnSpacing="12" HorizontalAlignment="Center" Margin="0,30,0,0">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
              </Grid.ColumnDefinitions>
              <Button Content="Create Project" Command="{x:Bind ViewModel.CreateProjectCommand}" />
              <Button Grid.Column="1" Content="Lorem Ipsum" />
            </Grid>
          </Grid>
        </Grid>
      </Frame>
    </NavigationView>
  </Grid>
</Page>
